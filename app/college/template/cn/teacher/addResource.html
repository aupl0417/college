<!-- 内容-->
<script src="{_TEMP_PUBLIC_}/plugins/moment.min.js"></script>
<link href="{_TEMP_PUBLIC_}/plugins/bootstrap-fileinput/bootstrap-fileinput.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="{_TEMP_PUBLIC_}/plugins/bootstrap-fileinput/bootstrap-fileinput.js" ></script>
<script type="text/javascript" src="{_TEMP_PUBLIC_}/plugins/uploadify/jquery.uploadify.min.js"></script>
<link href="{_TEMP_PUBLIC_}/plugins/uploadify/uploadify.css" rel="stylesheet" type="text/css" />
<link href="{_TEMP_PUBLIC_}/plugins/uploadify/common.css" rel="stylesheet" type="text/css" />

<!-- end 功能模块的标题-->
<!-- 内容-->
<div class="row">
    <div class="col-md-12">
        <!-- BEGIN ALERTS PORTLET-->
        <div class="portlet light">
            <div class="portlet-title">
                <div class="caption"><i class="fa fa-pencil"></i>添加课件</div>
            </div>
            <div class="portlet-body form">
                <!-- BEGIN FORM-->
                <form action="/teacher/addResource.json" id="form_edit" class="form-horizontal form-row-seperated" method="post">
                    
                    <div class="form-group">
				      	<label class="control-label col-md-2">课件名称</label>
				      	<div class="col-md-10">
				        	<input type="text" name="name" class="form-control"/>
				      	</div>
				    </div>
				    <div class="form-group">
				      	<label class="control-label col-md-2">所属课程</label>
				      	<div class="col-md-10">
			      			<select name='courseId' class="form-control">
								<option value=''>--请选择--</option>
								<!-- <loop data="courseList"> -->
									<option value='{co_id}'>{co_name}</option>
								<!-- </loop> -->
							</select>
				      	</div>
				    </div>
				    <div class="form-group">
				      	<label class="control-label col-md-2">文件类型</label>
				      	<div class="col-md-10">
			      			<select name='type' class="form-control">
								<option value='-1'>--请选择--</option>
								<option value='0'>文档文件</option>
								<option value='1'>视频</option>
							</select>
				      	</div>
				    </div>
					<div class="form-group">
				      	<label class="control-label col-md-2">是否共享</label>
				      	<div class="col-md-10">
			      			<input type='radio' name='isPublic' value='1'/>是　<input type='radio' checked='checked' name='isPublic' value='0'/>否
				      	</div>
				    </div>
                    <!-- 
					<div class="form-body clearfix upload display-hide" id='addFile'>
                        <div class="form-group form-md-line-input upload-row-hide display-hide">
                            <label class="col-md-2 control-label">上传文件&nbsp;[<a href="javascript:void(0);" class="add-upload-row display-hide"><i class="fa fa-plus"></i></a><a href="javascript:void(0);" class="del-upload-row display-hide"><i class="fa fa-minus"></i></a>]</label>
                            <div class="col-md-4">
                                <div class="fileinput fileinput-new" data-provides="fileinput">
                                    <div class="caption">
                                        <span class="btn blue btn-xs btn-file">
                                            <i class="fa fa-upload"></i>
                                            <span class="fileinput-new"> 选择文件 </span>
                                            <span class="fileinput-exists"> 重新选择 </span>
                                            <input type="file" name="upload[]" onchange="PreviewImage(this);">
                                        </span>
                                        <span class="fileinput-filename"> </span> &nbsp;
                                        <a href="javascript:;" class="close fileinput-exists" data-dismiss="fileinput"> </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
					-->
					<div class="form-group" id='addFile'>
                        <label class="control-label col-md-2">上传PPT文件</label>
                        <div class="col-md-10">
                            <!--<input type='radio' name='isPublic' value='1'/>是　<input type='radio' checked='checked' name='isPublic' value='0'/>否-->
                            <input type="file" name="file" id='upload-file'>
                            <textarea id='showfile' readonly rows="5" cols="100" style='border:0px;'></textarea>
                            <input type="hidden" name="filename" id='files'>
                            <input type="hidden" name="keys" id='keys'>
                        </div>
                    </div>
                    <div class="form-group addVideo display-hide">
				      	<label class="control-label col-md-2">视频封面</label>
				      	<div class="col-md-10">
				      		<div class='row'>
				      			<div class="col-sm-12 col-md-4 hiduploader">
									<div data-provides="fileinput" class="fileinput">
										<div class="thumbnail">
											<img alt="视频封面" src="{_TEMP_PUBLIC_}/images/none.png" class="img-reponsetive">
											<input type="hidden" value="" name="logo">
										</div>
									</div>
									<div class="input-group modalUpload" data-savename="1" data-url="/public/uploadPhoto.json">
										<span class="input-group-btn">
											<button type="button" class="btn blue start btn-block">
												<i class="fa fa-upload"></i>
												视频封面
											</button>
										</span>
									</div>
								</div>
					    	</div>
				      	</div>
				    </div>
				    <div class="form-group addVideo display-hide">
				      	<label class="control-label col-md-2">视频名称</label>
				      	<div class="col-md-5">
				      		<input type="text" name="video" class="form-control" readonly placeholder='视频名称'/>
				      	</div>
				    </div>
				    
				    <div class="form-group addVideo display-hide">
				      	<label class="control-label col-md-2">上传视频</label>
				      	<div class="col-md-10">
				      		<div class='row'>
				      			<div class="col-sm-12 col-md-5 hiduploader">
									<div class="input-group modalUpload" data-savename="1" data-url="/public/uploadVideo.json">
										<span class="input-group-btn">
											<input type="text" id='videoAddr' name='videoUrl' class="form-control col-md-6" readonly placeholder='视频地址'/>
											<input type="file" name="file" id="upload-video" class='btn blue'>
											<input type="hidden" name="filekey" id="filekey">
										</span>
									</div>
								</div>
					    	</div>
				      	</div>
				      	<label class="control-label col-md-2"></label>
				      	<div class="col-md-10">
							<span style="height:34px;line-height:34px;color:red;">视频编码必须是H264的mp4视频</span>
						</div>
				    </div>
                    <div class="form-actions">
                        <div class="row">
                            <div class="col-md-offset-2 col-md-9">
                                <button type="submit" class="btn blue" id="subBtn">提交</button>
                                <button type="button" class="btn default" data-dismiss="modal">取消</button>
                            </div>
                        </div>
                    </div>
                </form>
                <!-- END FORM-->
            </div>
        </div>
        <!-- END ALERTS PORTLET-->
    </div>
</div>

<replace value="code|token|domain">
    <script type="text/javascript">
        $().ready(function () {
        	var currentMenuId = '{code}';
        });
        var token = '{token}';
		$('#addFile').hide();
		$('.addVideo').hide();
		uploadify('upload-file', 0);
        $('select[name=type]').change(function(){
        	var type = $(this).children('option:selected').val();
        	if(type == 0){
        		$('#addFile').show();
        		$('.addVideo').hide();
				var id = 'upload-file';
				$('#showfile').val('');
				$('#files').val('');
				$('#keys').val('');
        	}else if(type == 1) {
        		$('#addFile').hide();
        		$('.addVideo').show();
				var id = 'upload-video';
				$('#videoAddr').val('');
				$('#filekey').val('');
				$('#openVideo').attr('');
        	}else if(type == -1) {
				$('#addFile').hide();
				$('.addVideo').hide();
				
			}
			uploadify(id, type);
        });
    

//上传文件
/* 初始化上传插件 */
function uploadify(id, type){
	console.log(id);
	var multi = false;
	if(type == 0){
		multi = true;
	}
	$("#" + id).uploadify({
		"swf"             : "{_TEMP_PUBLIC_}/plugins/uploadify/uploadify.swf",
		"fileObjName"     : "file",
		'cancelImg'		  : '{_TEMP_PUBLIC_}/plugins/uploadify/cancel.png',
		"buttonText"      : "上传文件",
		"uploader"        : "http://up.qiniu.com",
		"width"           : 80,
		"height"          : 34,
		'formData'        : {'token' : token },
		'removeTimeout'   : 1,
		'onInit'		  : init,
		'multi'			  : multi,
		"onUploadSuccess" : uploadSuccess,
		'onFallback' : function() {
			alert('未检测到兼容版本的Flash.');
		}
	});
	function init(){
		$('#' + id + ', #upload-file-queue').css('display','inline-block');
	}

	/* 文件上传成功回调函数 */
	function uploadSuccess(file, data){
		$("input[name='video']").val(file.name);
		var domain = '{domain}';
		var data = $.parseJSON(data);

		if(data.key != ''){
			if(type == 0){
				var fileString = '';
				if($('#showfile').val() == ''){
					fileString = file.name
				}else {
					fileString += $('#showfile').val() + '\n' + file.name;
				}
				$('#showfile').val(fileString);
				$('#files').val($('#files').val() + ',' + file.name);
				$('#keys').val($('#keys').val() + ',' + data.key);
			}else {
				$('#videoAddr').val('http://' + domain + '/' + file.name);
				$('#filekey').val(data.key);
				$('#openVideo').attr('href', data.key).removeClass('hide');
			}
			
		}
	}
}
</script>
</replace>
<script src="{_TEMP_ACTION_}/scripts/addResource.js" type="text/javascript"></script>
